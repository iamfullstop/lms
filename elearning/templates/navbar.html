<style>

.navbar {
    font-family: Arial, sans-serif;
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  position: relative;
  z-index: 1000;
}
.navbar-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Logo */
.navbar-logo a {
  font-size: 1.5rem;
  font-weight: bold;
  color: #1D4ED8;
  text-decoration: none;
}

/* Hamburger */
.navbar-toggle {
  display: none;
  font-size: 1.5rem;
  background: none;
  border: none;
  cursor: pointer;
}

/* Nav links */
.navbar-links {
  display: flex;
  align-items: center;
  gap: 15px;
}
.navbar-links a {
  text-decoration: none;
  padding: 8px 12px;
  border-radius: 4px;
  color: #1f2937;
  transition: background 0.3s;
}
.navbar-links a:hover {
  background: #f3f4f6;
}

/* User button */
.user-btn {
  width: 40px;
  height: 40px;
  background: #1D4ED8;
  color: #fff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  position: relative;
}

/* Dropdown menu */
.user-menu {
  position: absolute;
  top: 50px;
  right: 0;
  width: 200px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s ease;
  z-index: 1000;
}
.user-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}
.user-menu a {
  display: block;
  padding: 10px 15px;
  color: #1f2937;
  text-decoration: none;
  transition: background 0.2s;
}
.user-menu a:hover {
  background: #f3f4f6;
}

/* Mobile menu */
.mobile-menu {
  display: none;
  flex-direction: column;
  gap: 10px;
  padding: 10px 20px;
  border-top: 1px solid #ddd;
}
.mobile-menu.show {
  display: flex;
}

/* Search */
.navbar-search {
  position: relative;
}
.navbar-search input {
  padding: 8px 12px 8px 35px;
  border-radius: 20px;
  border: 1px solid #ccc;
  outline: none;
  width: 200px;
  transition: width 0.3s;
}
.navbar-search input:focus {
  width: 300px;
  border-color: #1D4ED8;
}
.navbar-search i {
  position: absolute;
  top: 50%;
  left: 10px;
  transform: translateY(-50%);
  color: #9ca3af;
}

/* Search results dropdown */
.search-results {
  position: absolute;
  top: 40px;
  left: 0;
  width: 100%;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 6px;
  max-height: 250px;
  overflow-y: auto;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s ease;
  z-index: 1000;
}
.search-results.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}
.search-results a {
  display: flex;
  gap: 10px;
  padding: 8px 10px;
  text-decoration: none;
  color: #1f2937;
}
.search-results a:hover {
  background: #f3f4f6;
}
.search-results img {
  width: 40px;
  height: 40px;
  border-radius: 4px;
  object-fit: cover;
}

/* Responsive */
@media(max-width: 768px){
  .navbar-toggle {
    display: block;
  }
  .navbar-links {
    display: none;
  }
  .navbar-links.mobile-show {
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: absolute;
    top: 60px;
    left: 0;
    width: 100%;
    background: #fff;
    padding: 10px 20px;
    border-top: 1px solid #ddd;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
}
</style>

<nav class="navbar">
  <div class="navbar-container">
    <div class="navbar-logo">
      <a href="{% url 'home' %}">ShikyalayaGyan</a>
    </div>
    <button class="navbar-toggle" id="mobile-toggle">
      &#9776;
    </button>

    <div class="navbar-search">
      <form id="search-form" action="{% url 'search_course' %}" method="get">
        <input type="text" id="search-input" placeholder="Search courses..." autocomplete="off">
        <i class="fas fa-search"></i>
      </form>
      <div id="search-results" class="search-results"></div>
    </div>

    <div class="navbar-links" id="navbar-links">
      {% if request.user.is_authenticated %}
      <div class="user-btn" id="user-btn">{{ request.user.username|first|upper }}</div>
      <div class="user-menu" id="user-menu">
        {% if request.user.role == 'instructor' %}
          <a href="{% url 'instructor_dashboard' %}">Dashboard</a>
          <a href="{% url 'create_courses' %}">Add Course</a>
          <a href="{% url 'list_courses' %}">My Courses</a>
        {% elif request.user.role == 'student' %}
          <a href="{% url 'student_dashboard' %}">Dashboard</a>
          <a href="{% url 'enrolled_courses' %}">Enrolled Courses</a>
        {% endif %}
        <a href="{% url 'profile' %}">Profile</a>
        <a href="{% url 'change_password' %}">Change Password</a>
        <a href="{% url 'logout' %}" style="color:red;">Logout</a>
      </div>
      {% else %}
      <a href="{% url 'login' %}">Log In</a>
      <a href="{% url 'register' %}" style="background:#1D4ED8;color:#fff;">Join Free</a>
      {% endif %}
    </div>
  </div>
</nav>

<script>
  // User dropdown toggle
  const userBtn = document.getElementById("user-btn");
  const userMenu = document.getElementById("user-menu");
  userBtn?.addEventListener("click", () => {
    userMenu.classList.toggle("show");
  });
  document.addEventListener("click", (e) => {
    if (!userMenu.contains(e.target) && e.target !== userBtn) userMenu.classList.remove("show");
  });

  // Mobile menu toggle
  const mobileToggle = document.getElementById("mobile-toggle");
  const navbarLinks = document.getElementById("navbar-links");
  mobileToggle.addEventListener("click", () => {
    navbarLinks.classList.toggle("mobile-show");
  });

  // Search results (simplified)
  const searchInput = document.getElementById("search-input");
  const resultsBox = document.getElementById("search-results");
  const searchForm = document.getElementById("search-form");
  const searchUrl = "{% url 'search_course' %}";

  searchInput?.addEventListener("input", async function () {
    const query = this.value.trim();
    if (query.length < 2) {
      resultsBox.classList.remove("show");
      return;
    }
    try {
      const response = await fetch(`${searchUrl}?q=${encodeURIComponent(query)}`, { headers: { "X-Requested-With": "XMLHttpRequest" }});
      const results = await response.json();
      if(results.length>0){
        resultsBox.innerHTML = results.map(course => `
          <a href="/courses/${course.id}/">
            <img src="${course.thumbnail}">
            <div>
              <p>${course.title}</p>
            </div>
          </a>
        `).join('');
        resultsBox.classList.add("show");
      } else {
        resultsBox.innerHTML = '';
        resultsBox.classList.remove("show");
      }
    } catch(err){ console.error(err); }
  });
  document.addEventListener("click", (e) => {
    if (!resultsBox.contains(e.target) && e.target !== searchInput) resultsBox.classList.remove("show");
  });
</script>
